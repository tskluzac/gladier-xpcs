{%extends "global/tabbed-project/../global/tabbed-project/detail-base.html" %}
{% load static humanize %}

{%block headextras%}
<link rel="stylesheet" type="text/css" href="{% static 'css/search.css' %}" />
<link rel="stylesheet" type="text/css" href="{% static 'css/detail-base.css' %}" />
<link rel="stylesheet" type="text/css" href="{% static 'css/detail-overview.css' %}" />
<script src="{% static 'js/../../static/js/on-image-error.js' %}"></script>
<script src="{% static 'js/../../static/js/image-range-picker.js' %}"></script>
<script src="{% static 'js/../../static/js/load-images.js' %}"></script>
<script src="{% static 'js/../../static/js/copy-to-clipboard.js' %}"></script>
<script>
  let searchResultPreviewImages = [
  {% for preview_image in detail_preview_pngs %}
    {
      'id': '{{preview_image.id}}',
      'imgURL': '{{preview_image.url}}',
    },
  {% endfor %}
  ]
  console.log(searchResultPreviewImages);

  $(document).ready(function() {

    getAccessToken("{% url 'access_token' %}", "petrel_https_server")
      .then(response => fetchImages(searchResultPreviewImages, response.token))

  });

</script>
{%endblock%}

{% block breadcrumb_items %}
<li class="breadcrumb-item"><a class="h5" href="{% url 'index-selection' %}">{{globus_portal_framework.project_title}}</a></li>
<li class="breadcrumb-item"><a class="h5" href="{% url 'tp-landing-page' index=globus_portal_framework.index %}">{{globus_portal_framework.index_data.name}}</a></li>
<li class="breadcrumb-item"><a class="h5" href="{% url 'tp-project-search' index=globus_portal_framework.index project=project %}">{{project_info.title}} Search</a></li>
<li class="breadcrumb-item active"><a class="h5">{{title|default:'Search Result'}}</a></li>
{% endblock %}

{% block detail_back_to_search %}
<div class="container mt-3">
  <div class="row">
    <div class="col-md-12">
      <div class="alert alert-info" role="alert">
        <a href="{% url 'tp-project-search' globus_portal_framework.index project %}?{{request.session.search.full_query}}">Back to Search</a>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block detail_body %}
<h3 class="text-center mb-5 h3">Preview</h3>
<div class="row">
  {% for preview_image in detail_listing_preview_pngs %}
  {% include 'kasthuri/global/tabbed-project/components/global/tabbed-project/components/detail-preview-image.html' %}
  {% empty %}
  <center>No preview images available for the dataset</center>
  {% endfor %}
</div>

<div class="mt-3 alert alert-info" role="alert">
  <p>Images may render as black or white images, requiring adjustment for details to appear.</p>
</div>

<div class="row">

  <div class="col-md-12 text-center">
    <h3 class="mb-3 h3"><a name="summary">Summary</a></h3>
  </div>

  {% if description %}
  <div class="col-md-1"></div>
  <div class="col-md-10">
    <div class="alert alert-secondary" role="alert">
      <p>{{description|default:'No description was provided for this entry.'}}</p>
    </div>
  </div>
  <div class="col-md-1"></div>
  {% endif %}

  <div class="col-md-1"></div>
  <div class="col-md-5">{% include 'xpcs/global/tabbed-project/components/detail-overview/dc-metadata.html' %}</div>
  <div class="col-md-5">
    <table class="table table-striped table-bordered">
      <tbody>
      {% for result in detail_results %}
      <tr>
        <td>{{result.name}}</td>
        {% if result.type == 'int' %}
        <td>{{result.value|intcomma}}</td>
        {% elif result.type == 'url' %}
        <td><a target="_blank" href="{{item.value}}">Link to H5</a></td>
        {% elif result.type == 'filesize' %}
        <td>{{result.value|filesizeformat}}</td>
        {% elif result.type == 'range' %}
        <td>{{result.value.from}} - {{result.value.to}}</td>
        {% elif result.type == 'percentage' %}
        <td>{{result.value|floatformat:1}}%</td>
        {% else %}
        <td>{{result.value}}</td>
        {% endif %}
      </tr>
      {% endfor %}
      </tbody>
    </table>
  </div>
  <div class="col-md-1"></div>

</div>

{% if other_previews %}
<div class="row">
  <div class="col-md-12 text-center">
    <h2><a name="correlation_preview">Other Previews</a></h2>(<a href="#top">Top</a>)<br>
  </div>
</div>
<div class="row">
  {% for preview_image in other_previews %}
  {% include 'kasthuri/global/tabbed-project/components/global/tabbed-project/components/detail-preview-image.html' %}
  {% endfor %}
</div>
{% endif %}


{% endblock %}