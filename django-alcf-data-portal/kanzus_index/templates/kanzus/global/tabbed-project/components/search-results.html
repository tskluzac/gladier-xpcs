{% load static humanize %}

{% block headextras %}
{% endblock %}

<h3 class="h3">Results</h3>
<div class="alert alert-secondary">
  <h6 class="h6">Search Statistics</h6>
  <ul>
    <li>{{search.total}} datasets found</li>
    {% for stat in search.search_statistics %}
    <li>{{ stat.name }}: {{ stat.value|floatformat:1 }}{% if stat.name == 'Hit Rate'%}%{%endif%}</li>
    {% endfor %}
  </ul>
  <p class="small">Statistics are approximate, and may deviate up to 10% from actual values</p>
</div>
{% if search.total %}
{% endif %}
<div id="search-result" class="search-result">
  {% for result in search.search_results %}
  <div class="card my-3">
    <div class="card-header">
      <h3 class="search-title">
        <a href="{% url 'tp-project-detail' globus_portal_framework.index project result.subject %}">{{result.title|default:'Sample'}}</a>
      </h3>
    </div>
    <div class="card-body">
      <div class="row">
        <div class="col-md-8">
          <table class="table table-sm borderless">
            <tbody>
            <tr>
              {% for search_result in result.search_results %}
              <th>{{search_result.name}}</th>
              {% endfor %}
            </tr>
            <tr>

              {% for search_result in result.search_results %}
              {% if search_result.type == 'int' %}
              <td>{{search_result.value|intcomma}}</td>
              {% elif search_result.type == 'filesize' %}
              <td>{{search_result.value|filesizeformat}}</td>
              {% elif search_result.type == 'range' %}
              <td>{{search_result.value.from}} - {{search_result.value.to}}</td>
              {% elif search_result.type == 'percentage' %}
              <td>{{search_result.value|floatformat:1}}%</td>
              {% else %}
              <td>{{search_result.value}}</td>
              {% endif %}
              {% endfor %}
            </tr>
            </tbody>
          </table>
          <p class="card-text">{{result.truncated_description}}</p>
          <p class="card-text">Int Files:
            <a class="btn btn-outline-info btn-sm" target="_blank" href="{{result.https_url}}">{{result.https_url_filename}}</a>
          </p>
          <p class="card-text">Full Size Image Preview:
            <a class="btn btn-outline-info btn-sm" target="_blank" href="{{result.listing_preview.url}}">{{result.listing_preview_filename}}</a>
          </p>
          <p class="card-text">
            {% if result.latest_date %}
            {{result.latest_date.dateType}}: {{result.latest_date.date|date:"DATETIME_FORMAT"}}
            {% endif %}
          </p>
        </div>
        <div class="col-md-4 mb-3">
          <div class="card-image" style="width: 70%; height: 70%;">
            {% comment %}
            forloop.counter refers to the current result being rendered. This list
            is built in the detail-overview.html template, and is dependent on the
            order of the search results listing.
            {% endcomment %}
            <div id="preview-content-{{forloop.counter}}"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
  {% endfor %}
</div>