{%extends "global/tabbed-project/../../../alcf_data_portal/templates/global/tabbed-project/detail-base.html" %}
{% load static humanize %}

{% block headextras %}
<script type="text/javascript" src="{% static 'js/../../../alcf_data_portal/static/js/general-preview.js' %}"></script>
<link rel="stylesheet" type="text/css" href="/static/css/search.css" />
<script>
  // Disable Column Truncation
  // TRUNCATE_TABULAR_DATA_COLUMNS = 0;

  let rfmFiles = [
  {% for file in all_preview %}
    {
      'id': '{{file.id}}',
      'url': '{{file.url}}',
      'mimetype': '{{file.mime_type|default:"image/png"}}',
      'previewBytes': '{{file.field_metadata.previewbytes}}',
    },
  {% endfor %}
  ]
  function f(file, name) {
      getAccessToken("{% url 'access_token' %}", "petrel_https_server")
      .then(token => loadContent(file, token, name))
  }

  for (var i = 0; i < rfmFiles.length; i++) {f(rfmFiles[i], 'preview-content-' + rfmFiles[i]['id'])}
</script>
<style>
@media print {
  .row {
    page-break-before: always;
  }
}
</style>
{% endblock %}

{% block breadcrumb_items %}
<li class="breadcrumb-item"><a class="h5" href="{% url 'index-selection' %}">{{globus_portal_framework.project_title}}</a></li>
<li class="breadcrumb-item"><a class="h5" href="{% url 'tp-landing-page' index=globus_portal_framework.index %}">{{globus_portal_framework.index_data.name}}</a></li>
<li class="breadcrumb-item"><a class="h5" href="{% url 'tp-project-search' index=globus_portal_framework.index project=project %}">{{project_info.title}} Search</a></li>
<li class="breadcrumb-item active"><a class="h5">{{title|default:'Search Result'}}</a></li>
{% endblock %}

{% block detail_back_to_search %}
<div class="container mt-3">
  <div class="row">
    <div class="col-md-12">
      <div class="alert alert-info" role="alert">
        <a href="{% url 'tp-project-search' globus_portal_framework.index project %}?{{request.session.search.full_query}}">Back to Search</a>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block detail_body %}


<div class="row">

  <div class="col-md-1"></div>
  <div class="col-md-10">
    <div class="card mt-3" style="">
      <div id="preview-content-{{listing_preview.id}}"></div>
      <!--<div class="card-body">-->
        <!--<p class="card-text">{{listing_preview.caption}}</p>-->
      <!--</div>-->
    </div>
  </div>
  <div class="col-md-1"></div>

  <div class="col-md-12 text-center">
    <h3 class="mb-3 h3"><a name="summary">Summary</a></h3>
    (<a href="#top">Top</a>)
  </div>

  <div class="col-md-1"></div>
  <div class="col-md-5">{% include 'xpcs/global/tabbed-project/components/detail-overview/dc-metadata.html' %}</div>
  <div class="col-md-5">
    <table class="table table-striped table-bordered">
      <tbody>

      {% for group in cherry_picked_detail %}
      <tr><td colspan="2" class="text-center"><strong>{{group.name}}</strong></td></tr>
        {% for field in group.fields %}
        <tr>
          <td>{{field.name}}</td>
          <td>
              {% if field.type == 'int' %}
              {{field.value|intcomma}}
              {% elif field.type == 'filesize' %}
              {{field.value|filesizeformat}}
              {% else %}
              {{field.value}}
              {% endif %}
          </td>
        </tr>
        {% endfor %}
      {% endfor %}
      </tbody>
    </table>
  </div>
  <div class="col-md-1"></div>

</div>

<div class="row">
  {% if detail_field_groups %}
  <div class="col-md-12 mt-5 text-center">
    <h2 class="mb-3 h3"><a name="detailed_metadata">Detailed Metadata</a></h2>(<a href="#top">Top</a>)
  </div>
  {% endif %}

  {% for dmg in detail_field_groups %}

  <div class="col-md-6">
    <h5 class="text-center mb-3 h3">{{dmg.name}}</h5>
    <table class="table table-striped table-bordered">
      <tbody>
        {% for item in dmg.fields %}
        <tr>
          <td>{{item.name}}</td>
          {% if item.type == 'int' %}
          <td>{{item.value|intcomma}}</td>
          {% elif item.type == 'filesize' %}
          <td>{{item.value|filesizeformat}}</td>
          {% else %}
          <td>{{item.value}}</td>
          {% endif %}
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% endfor %}
</div>
{% endblock %}